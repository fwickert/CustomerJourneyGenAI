using CustomerJourney.API.Services;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using CustomerJourney.API.Models;
using CustomerJourney_API.Models.Request;

namespace CustomerJourney.API.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class CustomerHistoryController : ControllerBase
    {
        private readonly ILogger<CustomerHistoryController> _logger;

        private readonly LLMResponse _response;

        public CustomerHistoryController(ILogger<CustomerHistoryController> logger, LLMResponse response)
        {
            _logger = logger;
            _response = response;
            _response.PluginName = "CustomerHistoryPlugin";
        }

        //Function taht return list of CutomeContext
        [HttpGet("history", Name = "history")]
        [ProducesResponseType(StatusCodes.Status200OK)]
        public async Task<ActionResult<CustomContext>> GetHistory(string id)
        {
            try
            {
                List<CustomContext> customContexts = new List<CustomContext>();
                customContexts.Add(new CustomContext()
                {
                    ID = "CLIENT",
                    Language = "english",
                    Content = "Customer(003, “Sophie Dupont”, 34, “1989-03-15”, “France”, “Client”)\r\nProduct(400, “Luxor Diamond Watch”, 5000.00, “Watch”)\r\nProduct(401, “Luxor Pearl Necklace”, 3000.00, “Jewelry”)\r\nProduct(402, “Luxor Gold Bracelet”, 2000.00, “Jewelry”)\r\nProduct(403, “Luxor Sapphire Ring”, 4500.00, “Jewelry”)\r\nCategoryProduct(40, “Watch”)\r\nCategoryProduct(41, “Jewelry”)\r\nOrder(800, “2024-01-15”, 8000.00)\r\nOrder(801, “2024-03-10”, 4500.00)\r\nOrderLine(8001, 1, 5000.00)\r\nOrderLine(8002, 1, 3000.00)\r\nOrderLine(8011, 1, 4500.00)\r\nPageVisit(700, “/products/luxor-diamond-watch”, “2024-01-10”, 2)\r\nPageVisit(701, “/products/luxor-pearl-necklace”, “2024-01-10”, 1)\r\nPageVisit(702, “/products/luxor-sapphire-ring”, “2024-03-05”, 1)\r\nPageVisit(703, “/products/luxor-gold-bracelet”, “2024-03-05”, 2)\r\nPageVisit(704, “/products/luxor-diamond-watch”, “2024-04-20”, 1) // Visit without purchase\r\nCart(600, “2024-01-10”)\r\nCartItem(601, 1)\r\nCartItem(602, 1)\r\nCart(601, “2024-03-05”)\r\nCartItem(603, 1)\r\nCartItem(604, 1) // Item not purchased\r\nEvent(“NewYearSale”, “2024-01-01”, “2024-01-15”)\r\nEvent(“SpringCollectionLaunch”, “2024-03-01”, “2024-03-15”)\r\nEvent(“LuxuryExpo”, “2024-04-20”, “2024-04-20”)\r\nReview(900, “Luxor Diamond Watch”, 5, “Beautiful and very elegant watch.”)\r\nReview(901, “Luxor Pearl Necklace”, 4, “Very pretty, but the clasp is a bit difficult to handle.”)\r\nCustomerService(1000, “Broken watch”, “2024-02-20”, “Free repair under warranty.”)\r\nSophie - [MADE] -> Order(800)\r\nSophie - [MADE] -> Order(801)\r\nSophie - [VISITED] -> PageVisit(700)\r\nSophie - [VISITED] -> PageVisit(701)\r\nSophie - [VISITED] -> PageVisit(702)\r\nSophie - [VISITED] -> PageVisit(703)\r\nSophie - [VISITED] -> PageVisit(704)\r\nSophie - [ADDED_TO] -> Cart(600)\r\nSophie - [ADDED_TO] -> Cart(601)\r\nSophie - [INTERACTS_DURING] -> Event(“NewYearSale”)\r\nSophie - [INTERACTS_DURING] -> Event(“SpringCollectionLaunch”)\r\nSophie - [INTERACTS_DURING] -> Event(“LuxuryExpo”)\r\nSophie - [SUBMITTED] -> Review(900)\r\nSophie - [SUBMITTED] -> Review(901)\r\nSophie - [CONTACTED] -> CustomerService(1000)\r\nOrder(800) - [CONTAINS] -> OrderLine(8001)\r\nOrder(800) - [CONTAINS] -> OrderLine(8002)\r\nOrder(801) - [CONTAINS] -> OrderLine(8011)\r\nOrderLine(8001) - [OF] -> Product(400)\r\nOrderLine(8002) - [OF] -> Product(401)\r\nOrderLine(8011) - [OF] -> Product(403)\r\nPageVisit(700) - [TARGETS] -> Product(400)\r\nPageVisit(701) - [TARGETS] -> Product(401)\r\nPageVisit(702) - [TARGETS] -> Product(403)\r\nPageVisit(703) - [TARGETS] -> Product(402)\r\nPageVisit(704) - [TARGETS] -> Product(400)\r\nCart(600) - [CONTAINS_ITEM] -> CartItem(601)\r\nCart(600) - [CONTAINS_ITEM] -> CartItem(602)\r\nCart(601) - [CONTAINS_ITEM] -> CartItem(603)\r\nCart(601) - [CONTAINS_ITEM] -> CartItem(604)\r\nCartItem(601) - [REFERENCES] -> Product(400)\r\nCartItem(602) - [REFERENCES] -> Product(401)\r\nCartItem(603) - [REFERENCES] -> Product(403)\r\nCartItem(604) - [REFERENCES] -> Product(402) // Reference without purchase\r\nProduct(400) - [BELONGS_TO] -> CategoryProduct(40)\r\nProduct(401) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(402) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(403) - [BELONGS_TO] -> CategoryProduct(41)\r\nEvent(“NewYearSale”) - [TRIGGERS_SALES_OF] -> Product(400)\r\nEvent(“NewYearSale”) - [TRIGGERS_SALES_OF] -> Product(401)\r\nEvent(“SpringCollectionLaunch”) - [TRIGGERS_SALES_OF] -> Product(403)\r\nEvent(“LuxuryExpo”) - [TRIGGERS_INTEREST_IN] -> Product(400) // Interest without purchase\r\n\r\n\r\nExplanation of Sophie Dupont's Interactions with Luxor\r\nSophie Dupont, a customer from France, has interacted with Luxor by visiting several product pages, adding items to her cart, and making significant purchases. Her purchases have been influenced by special events like the New Year Sale and the Spring Collection Launch. The reviews she left on purchased products and her contact with customer service show her engagement and preferences. The page visits and items added to the cart without subsequent purchase also indicate her interest in certain products, which is valuable for analyzing the customer journey and improving conversion rates, especially during promotional events. As a client, she also participates in brand events, reinforcing her loyalty to Luxor.",
                    HtmlContent = "Content = \"Customer(003, “Sophie Dupont”, 34, “1989-03-15”, “France”, “Client”)\r\nProduct(400, “Luxor Diamond Watch”, 5000.00, “Watch”)\r\nProduct(401, “Luxor Pearl Necklace”, 3000.00, “Jewelry”)\r\nProduct(402, “Luxor Gold Bracelet”, 2000.00, “Jewelry”)\r\nProduct(403, “Luxor Sapphire Ring”, 4500.00, “Jewelry”)\r\nCategoryProduct(40, “Watch”)\r\nCategoryProduct(41, “Jewelry”)\r\nOrder(800, “2024-01-15”, 8000.00)\r\nOrder(801, “2024-03-10”, 4500.00)\r\nOrderLine(8001, 1, 5000.00)\r\nOrderLine(8002, 1, 3000.00)\r\nOrderLine(8011, 1, 4500.00)\r\nPageVisit(700, “/products/luxor-diamond-watch”, “2024-01-10”, 2)\r\nPageVisit(701, “/products/luxor-pearl-necklace”, “2024-01-10”, 1)\r\nPageVisit(702, “/products/luxor-sapphire-ring”, “2024-03-05”, 1)\r\nPageVisit(703, “/products/luxor-gold-bracelet”, “2024-03-05”, 2)\r\nPageVisit(704, “/products/luxor-diamond-watch”, “2024-04-20”, 1) // Visit without purchase\r\nCart(600, “2024-01-10”)\r\nCartItem(601, 1)\r\nCartItem(602, 1)\r\nCart(601, “2024-03-05”)\r\nCartItem(603, 1)\r\nCartItem(604, 1) // Item not purchased\r\nEvent(“NewYearSale”, “2024-01-01”, “2024-01-15”)\r\nEvent(“SpringCollectionLaunch”, “2024-03-01”, “2024-03-15”)\r\nEvent(“LuxuryExpo”, “2024-04-20”, “2024-04-20”)\r\nReview(900, “Luxor Diamond Watch”, 5, “Beautiful and very elegant watch.”)\r\nReview(901, “Luxor Pearl Necklace”, 4, “Very pretty, but the clasp is a bit difficult to handle.”)\r\nCustomerService(1000, “Broken watch”, “2024-02-20”, “Free repair under warranty.”)\r\nSophie - [MADE] -> Order(800)\r\nSophie - [MADE] -> Order(801)\r\nSophie - [VISITED] -> PageVisit(700)\r\nSophie - [VISITED] -> PageVisit(701)\r\nSophie - [VISITED] -> PageVisit(702)\r\nSophie - [VISITED] -> PageVisit(703)\r\nSophie - [VISITED] -> PageVisit(704)\r\nSophie - [ADDED_TO] -> Cart(600)\r\nSophie - [ADDED_TO] -> Cart(601)\r\nSophie - [INTERACTS_DURING] -> Event(“NewYearSale”)\r\nSophie - [INTERACTS_DURING] -> Event(“SpringCollectionLaunch”)\r\nSophie - [INTERACTS_DURING] -> Event(“LuxuryExpo”)\r\nSophie - [SUBMITTED] -> Review(900)\r\nSophie - [SUBMITTED] -> Review(901)\r\nSophie - [CONTACTED] -> CustomerService(1000)\r\nOrder(800) - [CONTAINS] -> OrderLine(8001)\r\nOrder(800) - [CONTAINS] -> OrderLine(8002)\r\nOrder(801) - [CONTAINS] -> OrderLine(8011)\r\nOrderLine(8001) - [OF] -> Product(400)\r\nOrderLine(8002) - [OF] -> Product(401)\r\nOrderLine(8011) - [OF] -> Product(403)\r\nPageVisit(700) - [TARGETS] -> Product(400)\r\nPageVisit(701) - [TARGETS] -> Product(401)\r\nPageVisit(702) - [TARGETS] -> Product(403)\r\nPageVisit(703) - [TARGETS] -> Product(402)\r\nPageVisit(704) - [TARGETS] -> Product(400)\r\nCart(600) - [CONTAINS_ITEM] -> CartItem(601)\r\nCart(600) - [CONTAINS_ITEM] -> CartItem(602)\r\nCart(601) - [CONTAINS_ITEM] -> CartItem(603)\r\nCart(601) - [CONTAINS_ITEM] -> CartItem(604)\r\nCartItem(601) - [REFERENCES] -> Product(400)\r\nCartItem(602) - [REFERENCES] -> Product(401)\r\nCartItem(603) - [REFERENCES] -> Product(403)\r\nCartItem(604) - [REFERENCES] -> Product(402) // Reference without purchase\r\nProduct(400) - [BELONGS_TO] -> CategoryProduct(40)\r\nProduct(401) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(402) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(403) - [BELONGS_TO] -> CategoryProduct(41)\r\nEvent(“NewYearSale”) - [TRIGGERS_SALES_OF] -> Product(400)\r\nEvent(“NewYearSale”) - [TRIGGERS_SALES_OF] -> Product(401)\r\nEvent(“SpringCollectionLaunch”) - [TRIGGERS_SALES_OF] -> Product(403)\r\nEvent(“LuxuryExpo”) - [TRIGGERS_INTEREST_IN] -> Product(400) // Interest without purchase\r\n\r\n\r\nExplanation of Sophie Dupont's Interactions with Luxor\r\nSophie Dupont, a customer from France, has interacted with Luxor by visiting several product pages, adding items to her cart, and making significant purchases. Her purchases have been influenced by special events like the New Year Sale and the Spring Collection Launch. The reviews she left on purchased products and her contact with customer service show her engagement and preferences. The page visits and items added to the cart without subsequent purchase also indicate her interest in certain products, which is valuable for analyzing the customer journey and improving conversion rates, especially during promotional events. As a client, she also participates in brand events, reinforcing her loyalty to Luxor.\""
                });

                customContexts.Add(new CustomContext()
                {
                    ID = "VIC",
                    Language = "english",
                    Content = "Customer(004, “Yuki Tanaka”, 45, “1979-04-22”, “Japan”, “VIP”)\r\nProduct(400, “Luxor Diamond Watch”, 5000.00, “Watch”)\r\nProduct(401, “Luxor Pearl Necklace”, 3000.00, “Jewelry”)\r\nProduct(402, “Luxor Gold Bracelet”, 2000.00, “Jewelry”)\r\nProduct(403, “Luxor Sapphire Ring”, 4500.00, “Jewelry”)\r\nCategoryProduct(40, “Watch”)\r\nCategoryProduct(41, “Jewelry”)\r\nOrder(900, “2024-02-20”, 9500.00)\r\nOrder(901, “2024-04-15”, 6500.00)\r\nOrderLine(9001, 1, 5000.00)\r\nOrderLine(9002, 1, 3000.00)\r\nOrderLine(9003, 1, 1500.00)\r\nOrderLine(9011, 1, 4500.00)\r\nOrderLine(9012, 1, 2000.00)\r\nPageVisit(800, “/products/luxor-diamond-watch”, “2024-02-15”, 3)\r\nPageVisit(801, “/products/luxor-pearl-necklace”, “2024-02-15”, 2)\r\nPageVisit(802, “/products/luxor-gold-bracelet”, “2024-04-10”, 1)\r\nPageVisit(803, “/products/luxor-sapphire-ring”, “2024-04-10”, 2)\r\nPageVisit(804, “/products/luxor-diamond-watch”, “2024-06-05”, 1) // Visit without purchase\r\nCart(700, “2024-02-15”)\r\nCartItem(701, 1)\r\nCartItem(702, 1)\r\nCartItem(703, 1)\r\nCart(701, “2024-04-10”)\r\nCartItem(704, 1)\r\nCartItem(705, 1)\r\nCart(702, “2024-06-05”) // Cart without purchase\r\nCartItem(706, 1) // Item not purchased\r\nCartItem(707, 1) // Item not purchased\r\nEvent(“ValentinesDay”, “2024-02-14”, “2024-02-14”)\r\nEvent(“SpringCollectionLaunch”, “2024-03-01”, “2024-03-15”)\r\nEvent(“LuxuryExpo”, “2024-06-05”, “2024-06-05”)\r\nReview(902, “Luxor Diamond Watch”, 5, “Exquisite watch, truly a masterpiece.”)\r\nReview(903, “Luxor Pearl Necklace”, 4, “Elegant, but the clasp could be improved.”)\r\nCustomerService(1001, “Bracelet adjustment”, “2024-04-20”, “Adjustable service provided at store.”)\r\nYuki - [MADE] -> Order(900)\r\nYuki - [MADE] -> Order(901)\r\nYuki - [VISITED] -> PageVisit(800)\r\nYuki - [VISITED] -> PageVisit(801)\r\nYuki - [VISITED] -> PageVisit(802)\r\nYuki - [VISITED] -> PageVisit(803)\r\nYuki - [VISITED] -> PageVisit(804)\r\nYuki - [ADDED_TO] -> Cart(700)\r\nYuki - [ADDED_TO] -> Cart(701)\r\nYuki - [ADDED_TO] -> Cart(702)\r\nYuki - [INTERACTS_DURING] -> Event(“ValentinesDay”)\r\nYuki - [INTERACTS_DURING] -> Event(“SpringCollectionLaunch”)\r\nYuki - [INTERACTS_DURING] -> Event(“LuxuryExpo”)\r\nYuki - [SUBMITTED] -> Review(902)\r\nYuki - [SUBMITTED] -> Review(903)\r\nYuki - [CONTACTED] -> CustomerService(1001)\r\nOrder(900) - [CONTAINS] -> OrderLine(9001)\r\nOrder(900) - [CONTAINS] -> OrderLine(9002)\r\nOrder(900) - [CONTAINS] -> OrderLine(9003)\r\nOrder(901) - [CONTAINS] -> OrderLine(9011)\r\nOrder(901) - [CONTAINS] -> OrderLine(9012)\r\nOrderLine(9001) - [OF] -> Product(400)\r\nOrderLine(9002) - [OF] -> Product(401)\r\nOrderLine(9003) - [OF] -> Product(402)\r\nOrderLine(9011) - [OF] -> Product(403)\r\nOrderLine(9012) - [OF] -> Product(402)\r\nPageVisit(800) - [TARGETS] -> Product(400)\r\nPageVisit(801) - [TARGETS] -> Product(401)\r\nPageVisit(802) - [TARGETS] -> Product(402)\r\nPageVisit(803) - [TARGETS] -> Product(403)\r\nPageVisit(804) - [TARGETS] -> Product(400)\r\nCart(700) - [CONTAINS_ITEM] -> CartItem(701)\r\nCart(700) - [CONTAINS_ITEM] -> CartItem(702)\r\nCart(700) - [CONTAINS_ITEM] -> CartItem(703)\r\nCart(701) - [CONTAINS_ITEM] -> CartItem(704)\r\nCart(701) - [CONTAINS_ITEM] -> CartItem(705)\r\nCart(702) - [CONTAINS_ITEM] -> CartItem(706)\r\nCart(702) - [CONTAINS_ITEM] -> CartItem(707)\r\nCartItem(701) - [REFERENCES] -> Product(400)\r\nCartItem(702) - [REFERENCES] -> Product(401)\r\nCartItem(703) - [REFERENCES] -> Product(402)\r\nCartItem(704) - [REFERENCES] -> Product(403)\r\nCartItem(705) - [REFERENCES] -> Product(402)\r\nCartItem(706) - [REFERENCES] -> Product(400) // Reference without purchase\r\nCartItem(707) - [REFERENCES] -> Product(401) // Reference without purchase\r\nProduct(400) - [BELONGS_TO] -> CategoryProduct(40)\r\nProduct(401) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(402) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(403) - [BELONGS_TO] -> CategoryProduct(41)\r\nEvent(“ValentinesDay”) - [TRIGGERS_SALES_OF] -> Product(400)\r\nEvent(“ValentinesDay”) - [TRIGGERS_SALES_OF] -> Product(401)\r\nEvent(“SpringCollectionLaunch”) - [TRIGGERS_SALES_OF] -> Product(403)\r\nEvent(“LuxuryExpo”) - [TRIGGERS_INTEREST_IN] -> Product(400) // Interest without purchase\r\n\r\n\r\nExplanation of Yuki Tanaka's Interactions with Luxor\r\nYuki Tanaka, a VIC from Japan, has interacted with Luxor by visiting several product pages, adding items to her cart, and making significant purchases. Her purchases have been influenced by special events like Valentine's Day and the Spring Collection Launch. The reviews she left on purchased products and her contact with customer service show her engagement and preferences. The page visits and items added to the cart without subsequent purchase also indicate her interest in certain products, which is valuable for analyzing the customer journey and improving conversion rates, especially during promotional events. As a VIC, she also participates in brand events, reinforcing her loyalty to Luxor.",
                    HtmlContent = "Customer(004, “Yuki Tanaka”, 45, “1979-04-22”, “Japan”, “VIP”)\r\nProduct(400, “Luxor Diamond Watch”, 5000.00, “Watch”)\r\nProduct(401, “Luxor Pearl Necklace”, 3000.00, “Jewelry”)\r\nProduct(402, “Luxor Gold Bracelet”, 2000.00, “Jewelry”)\r\nProduct(403, “Luxor Sapphire Ring”, 4500.00, “Jewelry”)\r\nCategoryProduct(40, “Watch”)\r\nCategoryProduct(41, “Jewelry”)\r\nOrder(900, “2024-02-20”, 9500.00)\r\nOrder(901, “2024-04-15”, 6500.00)\r\nOrderLine(9001, 1, 5000.00)\r\nOrderLine(9002, 1, 3000.00)\r\nOrderLine(9003, 1, 1500.00)\r\nOrderLine(9011, 1, 4500.00)\r\nOrderLine(9012, 1, 2000.00)\r\nPageVisit(800, “/products/luxor-diamond-watch”, “2024-02-15”, 3)\r\nPageVisit(801, “/products/luxor-pearl-necklace”, “2024-02-15”, 2)\r\nPageVisit(802, “/products/luxor-gold-bracelet”, “2024-04-10”, 1)\r\nPageVisit(803, “/products/luxor-sapphire-ring”, “2024-04-10”, 2)\r\nPageVisit(804, “/products/luxor-diamond-watch”, “2024-06-05”, 1) // Visit without purchase\r\nCart(700, “2024-02-15”)\r\nCartItem(701, 1)\r\nCartItem(702, 1)\r\nCartItem(703, 1)\r\nCart(701, “2024-04-10”)\r\nCartItem(704, 1)\r\nCartItem(705, 1)\r\nCart(702, “2024-06-05”) // Cart without purchase\r\nCartItem(706, 1) // Item not purchased\r\nCartItem(707, 1) // Item not purchased\r\nEvent(“ValentinesDay”, “2024-02-14”, “2024-02-14”)\r\nEvent(“SpringCollectionLaunch”, “2024-03-01”, “2024-03-15”)\r\nEvent(“LuxuryExpo”, “2024-06-05”, “2024-06-05”)\r\nReview(902, “Luxor Diamond Watch”, 5, “Exquisite watch, truly a masterpiece.”)\r\nReview(903, “Luxor Pearl Necklace”, 4, “Elegant, but the clasp could be improved.”)\r\nCustomerService(1001, “Bracelet adjustment”, “2024-04-20”, “Adjustable service provided at store.”)\r\nYuki - [MADE] -> Order(900)\r\nYuki - [MADE] -> Order(901)\r\nYuki - [VISITED] -> PageVisit(800)\r\nYuki - [VISITED] -> PageVisit(801)\r\nYuki - [VISITED] -> PageVisit(802)\r\nYuki - [VISITED] -> PageVisit(803)\r\nYuki - [VISITED] -> PageVisit(804)\r\nYuki - [ADDED_TO] -> Cart(700)\r\nYuki - [ADDED_TO] -> Cart(701)\r\nYuki - [ADDED_TO] -> Cart(702)\r\nYuki - [INTERACTS_DURING] -> Event(“ValentinesDay”)\r\nYuki - [INTERACTS_DURING] -> Event(“SpringCollectionLaunch”)\r\nYuki - [INTERACTS_DURING] -> Event(“LuxuryExpo”)\r\nYuki - [SUBMITTED] -> Review(902)\r\nYuki - [SUBMITTED] -> Review(903)\r\nYuki - [CONTACTED] -> CustomerService(1001)\r\nOrder(900) - [CONTAINS] -> OrderLine(9001)\r\nOrder(900) - [CONTAINS] -> OrderLine(9002)\r\nOrder(900) - [CONTAINS] -> OrderLine(9003)\r\nOrder(901) - [CONTAINS] -> OrderLine(9011)\r\nOrder(901) - [CONTAINS] -> OrderLine(9012)\r\nOrderLine(9001) - [OF] -> Product(400)\r\nOrderLine(9002) - [OF] -> Product(401)\r\nOrderLine(9003) - [OF] -> Product(402)\r\nOrderLine(9011) - [OF] -> Product(403)\r\nOrderLine(9012) - [OF] -> Product(402)\r\nPageVisit(800) - [TARGETS] -> Product(400)\r\nPageVisit(801) - [TARGETS] -> Product(401)\r\nPageVisit(802) - [TARGETS] -> Product(402)\r\nPageVisit(803) - [TARGETS] -> Product(403)\r\nPageVisit(804) - [TARGETS] -> Product(400)\r\nCart(700) - [CONTAINS_ITEM] -> CartItem(701)\r\nCart(700) - [CONTAINS_ITEM] -> CartItem(702)\r\nCart(700) - [CONTAINS_ITEM] -> CartItem(703)\r\nCart(701) - [CONTAINS_ITEM] -> CartItem(704)\r\nCart(701) - [CONTAINS_ITEM] -> CartItem(705)\r\nCart(702) - [CONTAINS_ITEM] -> CartItem(706)\r\nCart(702) - [CONTAINS_ITEM] -> CartItem(707)\r\nCartItem(701) - [REFERENCES] -> Product(400)\r\nCartItem(702) - [REFERENCES] -> Product(401)\r\nCartItem(703) - [REFERENCES] -> Product(402)\r\nCartItem(704) - [REFERENCES] -> Product(403)\r\nCartItem(705) - [REFERENCES] -> Product(402)\r\nCartItem(706) - [REFERENCES] -> Product(400) // Reference without purchase\r\nCartItem(707) - [REFERENCES] -> Product(401) // Reference without purchase\r\nProduct(400) - [BELONGS_TO] -> CategoryProduct(40)\r\nProduct(401) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(402) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(403) - [BELONGS_TO] -> CategoryProduct(41)\r\nEvent(“ValentinesDay”) - [TRIGGERS_SALES_OF] -> Product(400)\r\nEvent(“ValentinesDay”) - [TRIGGERS_SALES_OF] -> Product(401)\r\nEvent(“SpringCollectionLaunch”) - [TRIGGERS_SALES_OF] -> Product(403)\r\nEvent(“LuxuryExpo”) - [TRIGGERS_INTEREST_IN] -> Product(400) // Interest without purchase\r\n\r\n\r\nExplanation of Yuki Tanaka's Interactions with Luxor\r\nYuki Tanaka, a VIC from Japan, has interacted with Luxor by visiting several product pages, adding items to her cart, and making significant purchases. Her purchases have been influenced by special events like Valentine's Day and the Spring Collection Launch. The reviews she left on purchased products and her contact with customer service show her engagement and preferences. The page visits and items added to the cart without subsequent purchase also indicate her interest in certain products, which is valuable for analyzing the customer journey and improving conversion rates, especially during promotional events. As a VIC, she also participates in brand events, reinforcing her loyalty to Luxor."
                });

                customContexts.Add(new CustomContext()
                {
                    ID = "PROSPECT",
                    Language = "english",
                    Content = "Customer(006, “John Smith”, 38, “1986-09-10”, “United States”, “Prospect”)\r\nProduct(400, “Luxor Diamond Watch”, 5000.00, “Watch”)\r\nProduct(401, “Luxor Pearl Necklace”, 3000.00, “Jewelry”)\r\nProduct(402, “Luxor Gold Bracelet”, 2000.00, “Jewelry”)\r\nProduct(403, “Luxor Sapphire Ring”, 4500.00, “Jewelry”)\r\nCategoryProduct(40, “Watch”)\r\nCategoryProduct(41, “Jewelry”)\r\nPageVisit(900, “/products/luxor-diamond-watch”, “2024-02-15”, 2)\r\nPageVisit(901, “/products/luxor-pearl-necklace”, “2024-02-15”, 1)\r\nPageVisit(902, “/products/luxor-sapphire-ring”, “2024-04-10”, 2)\r\nPageVisit(903, “/products/luxor-gold-bracelet”, “2024-04-10”, 1)\r\nCart(800, “2024-02-15”) // Cart without purchase\r\nCartItem(801, 1) // Item not purchased\r\nCartItem(802, 1) // Item not purchased\r\nCart(801, “2024-04-10”) // Cart without purchase\r\nCartItem(803, 1) // Item not purchased\r\nCartItem(804, 1) // Item not purchased\r\nEvent(“ValentinesDay”, “2024-02-14”, “2024-02-14”)\r\nEvent(“SpringCollectionLaunch”, “2024-03-01”, “2024-03-15”)\r\nCustomer(006) - [VISITED] -> PageVisit(900)\r\nCustomer(006) - [VISITED] -> PageVisit(901)\r\nCustomer(006) - [VISITED] -> PageVisit(902)\r\nCustomer(006) - [VISITED] -> PageVisit(903)\r\nCustomer(006) - [ADDED_TO] -> Cart(800)\r\nCustomer(006) - [ADDED_TO] -> Cart(801)\r\nCustomer(006) - [INTERACTS_DURING] -> Event(“ValentinesDay”)\r\nCustomer(006) - [INTERACTS_DURING] -> Event(“SpringCollectionLaunch”)\r\nPageVisit(900) - [TARGETS] -> Product(400)\r\nPageVisit(901) - [TARGETS] -> Product(401)\r\nPageVisit(902) - [TARGETS] -> Product(403)\r\nPageVisit(903) - [TARGETS] -> Product(402)\r\nCart(800) - [CONTAINS_ITEM] -> CartItem(801)\r\nCart(800) - [CONTAINS_ITEM] -> CartItem(802)\r\nCart(801) - [CONTAINS_ITEM] -> CartItem(803)\r\nCart(801) - [CONTAINS_ITEM] -> CartItem(804)\r\nCartItem(801) - [REFERENCES] -> Product(400) // Reference without purchase\r\nCartItem(802) - [REFERENCES] -> Product(401) // Reference without purchase\r\nCartItem(803) - [REFERENCES] -> Product(403) // Reference without purchase\r\nCartItem(804) - [REFERENCES] -> Product(402) // Reference without purchase\r\nProduct(400) - [BELONGS_TO] -> CategoryProduct(40)\r\nProduct(401) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(402) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(403) - [BELONGS_TO] -> CategoryProduct(41)\r\nEvent(“ValentinesDay”) - [TRIGGERS_INTEREST_IN] -> Product(400) // Interest without purchase\r\nEvent(“ValentinesDay”) - [TRIGGERS_INTEREST_IN] -> Product(401) // Interest without purchase\r\nEvent(“SpringCollectionLaunch”) - [TRIGGERS_INTEREST_IN] -> Product(403) // Interest without purchase\r\n\r\n\r\nExplanation of John Smith's Interactions with Luxor\r\nJohn Smith, a prospect from the United States, has shown interest in Luxor's products by visiting several product pages and adding items to his cart, although he has not made any purchases yet. His interactions have been influenced by special events like Valentine's Day and the Spring Collection Launch. The page visits and items added to the cart without subsequent purchase indicate his potential interest in Luxor's luxury items, which is valuable information for analyzing the customer journey and improving conversion rates. As a prospect, John's activities can help Luxor target him with personalized marketing efforts to convert him into a purchasing customer.",
                    HtmlContent = "Customer(006, “John Smith”, 38, “1986-09-10”, “United States”, “Prospect”)\r\nProduct(400, “Luxor Diamond Watch”, 5000.00, “Watch”)\r\nProduct(401, “Luxor Pearl Necklace”, 3000.00, “Jewelry”)\r\nProduct(402, “Luxor Gold Bracelet”, 2000.00, “Jewelry”)\r\nProduct(403, “Luxor Sapphire Ring”, 4500.00, “Jewelry”)\r\nCategoryProduct(40, “Watch”)\r\nCategoryProduct(41, “Jewelry”)\r\nPageVisit(900, “/products/luxor-diamond-watch”, “2024-02-15”, 2)\r\nPageVisit(901, “/products/luxor-pearl-necklace”, “2024-02-15”, 1)\r\nPageVisit(902, “/products/luxor-sapphire-ring”, “2024-04-10”, 2)\r\nPageVisit(903, “/products/luxor-gold-bracelet”, “2024-04-10”, 1)\r\nCart(800, “2024-02-15”) // Cart without purchase\r\nCartItem(801, 1) // Item not purchased\r\nCartItem(802, 1) // Item not purchased\r\nCart(801, “2024-04-10”) // Cart without purchase\r\nCartItem(803, 1) // Item not purchased\r\nCartItem(804, 1) // Item not purchased\r\nEvent(“ValentinesDay”, “2024-02-14”, “2024-02-14”)\r\nEvent(“SpringCollectionLaunch”, “2024-03-01”, “2024-03-15”)\r\nCustomer(006) - [VISITED] -> PageVisit(900)\r\nCustomer(006) - [VISITED] -> PageVisit(901)\r\nCustomer(006) - [VISITED] -> PageVisit(902)\r\nCustomer(006) - [VISITED] -> PageVisit(903)\r\nCustomer(006) - [ADDED_TO] -> Cart(800)\r\nCustomer(006) - [ADDED_TO] -> Cart(801)\r\nCustomer(006) - [INTERACTS_DURING] -> Event(“ValentinesDay”)\r\nCustomer(006) - [INTERACTS_DURING] -> Event(“SpringCollectionLaunch”)\r\nPageVisit(900) - [TARGETS] -> Product(400)\r\nPageVisit(901) - [TARGETS] -> Product(401)\r\nPageVisit(902) - [TARGETS] -> Product(403)\r\nPageVisit(903) - [TARGETS] -> Product(402)\r\nCart(800) - [CONTAINS_ITEM] -> CartItem(801)\r\nCart(800) - [CONTAINS_ITEM] -> CartItem(802)\r\nCart(801) - [CONTAINS_ITEM] -> CartItem(803)\r\nCart(801) - [CONTAINS_ITEM] -> CartItem(804)\r\nCartItem(801) - [REFERENCES] -> Product(400) // Reference without purchase\r\nCartItem(802) - [REFERENCES] -> Product(401) // Reference without purchase\r\nCartItem(803) - [REFERENCES] -> Product(403) // Reference without purchase\r\nCartItem(804) - [REFERENCES] -> Product(402) // Reference without purchase\r\nProduct(400) - [BELONGS_TO] -> CategoryProduct(40)\r\nProduct(401) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(402) - [BELONGS_TO] -> CategoryProduct(41)\r\nProduct(403) - [BELONGS_TO] -> CategoryProduct(41)\r\nEvent(“ValentinesDay”) - [TRIGGERS_INTEREST_IN] -> Product(400) // Interest without purchase\r\nEvent(“ValentinesDay”) - [TRIGGERS_INTEREST_IN] -> Product(401) // Interest without purchase\r\nEvent(“SpringCollectionLaunch”) - [TRIGGERS_INTEREST_IN] -> Product(403) // Interest without purchase\r\n\r\n\r\nExplanation of John Smith's Interactions with Luxor\r\nJohn Smith, a prospect from the United States, has shown interest in Luxor's products by visiting several product pages and adding items to his cart, although he has not made any purchases yet. His interactions have been influenced by special events like Valentine's Day and the Spring Collection Launch. The page visits and items added to the cart without subsequent purchase indicate his potential interest in Luxor's luxury items, which is valuable information for analyzing the customer journey and improving conversion rates. As a prospect, John's activities can help Luxor target him with personalized marketing efforts to convert him into a purchasing customer."
                });

                //return result
                return Ok(customContexts.Single(q=>q.ID == id));
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error in Get Customer History");
                return StatusCode(StatusCodes.Status500InternalServerError, ex.Message);
            }
        }

        //function to getRecommendation based on plugin like marketing or customerservice
        [HttpPost("customerRecommendations", Name = "CustomerRecommendations")]
        [ProducesResponseType(StatusCodes.Status200OK)]
        public IResult GetSummarize([FromBody] CustomerHistoryRequest request, string connectionId)
        {
            _response.FunctionName = "Recommendations";

            this._logger.LogDebug("Recommendations receive request.");

            if (string.IsNullOrEmpty(request.History) || (string.IsNullOrEmpty(request.Language)) || string.IsNullOrEmpty(request.Brand))
            {
                return TypedResults.BadRequest("History is required.");
            }

            Task.Run(() => _response.GetAsync("Recommendations",
                new Dictionary<string, string>()
                {
                    { "history", request.History },
                    { "language", request.Language },
                    { "brand", request.Brand }

                }, connectionId));

            return TypedResults.Ok("Recommendations requested");
        }





    }
}

